{% extends 'base/base.html' %}

{% block title %}My Registered Events{% endblock title %}
{% block breadcrumb %}My Events{% endblock breadcrumb %}
{% load custom_filters %}
{% block content %}
<div class="row">
    <div class="col-md-12">
        {% for reg in registrations %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5>{{ reg.event.name }}</h5>
                    <p>Status: <strong>{{ reg.status }}</strong></p>
                    <p>Team Name:
    <strong>
        {% if reg.team %}
            {{ reg.team.name }}
        {% else %}
            {{ reg.team_name }}
        {% endif %}
    </strong>
</p>

                   <p>Team Size:
    <strong>
        {% if reg.team %}
            {{ reg.team.teammember_set.count }}
        {% else %}
            {{ reg.team_size }}
        {% endif %}
    </strong>
</p>

                </div>
                <div class="card-body">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Member Name</th>
                                <th>Email</th>
                                <th>Contact</th>
                                <th>Attendance</th>
                            </tr>
                        </thead>
                       <tbody>
    {% for member in reg.team_members.all %}
        <tr>
            <td>{{ member.name }}</td>
            <td>{{ member.email }}</td>
            <td>{{ member.contact_number }}</td>
            <td>
                {% with status=attendance_lookup|get_attendance:member.id %}
                    {% if status == "Present" %}
                        <span class="text-success">Present</span>
                    {% elif status == "Absent" %}
                        <span class="text-danger">Absent</span>
                    {% else %}
                        <span class="text-muted">No Record</span>
                    {% endif %}
                {% endwith %}
            </td>
        </tr>
    {% endfor %}
</tbody>

                    </table>
                </div>
            </div>
        {% empty %}
            <p class="text-center">You have not registered for any events.</p>
        {% endfor %}
    </div>
</div>
{% endblock content %}
